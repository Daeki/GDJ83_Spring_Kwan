<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.kwan.app.trades.TradeDAO">

 	<update id="work" parameterType="AccountDTO">
 	
 		UPDATE BANK SET BALANCE=BALANCE+10000 WHERE BANK_ID=#{bank_id}
 	
 	</update>
 	
 	<select id="checkpw" parameterType="AccountDTO" resultType="AccountDTO">
 	
 		SELECT BANK_PW FROM BANK WHERE BANK_ID = #{bank_id}
 	
 	</select>
 	
 	
 	<insert id="transfer" parameterType="TradeDTO">
 	
 		INSERT INTO BANK_INFOS
 		<choose>
 			<when test="difference>=0">
				VALUES (#{account_u}, CURRENT_DATE, #{difference}, #{bank_id},
				(SELECT BALANCE
					FROM BANK
					WHERE BANK_ID=#{account_u})+#{difference})
 			</when>
 			<otherwise>
 				VALUES (#{bank_id}, CURRENT_DATE, #{difference}, #{account_u},
				(SELECT BALANCE
					FROM BANK
					WHERE BANK_ID=#{bank_id})+#{difference})
 			
 			</otherwise>
 		
 		
 		</choose>
 		
 		
 	
 	</insert>
 	
 	<update id="upbal" parameterType="TradeDTO">
 		<!-- difference가 0보다 작으면 출금 크면 입금 -->
 		UPDATE BANK SET
 			<choose>
 				<when test="difference>=0">
 					BALANCE = BALANCE + #{difference} WHERE BANK_ID = #{account_u}
 				</when>
 				<otherwise>
 					BALANCE = BALANCE + #{difference} WHERE BANK_ID = #{bank_id}
 				</otherwise>
 			</choose>
 	</update>
 	
 </mapper>